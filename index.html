<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dobby Car</title>
  <style>
    body {
      margin: 0;
      background: #222;
      font-family: Arial, sans-serif;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      flex-direction: column;
    }
    #container {
      display: flex;
      flex-direction: row;
      gap: 20px;
      align-items: flex-start;
    }
    #dobby-container {
      width: 150px;
      background: #333;
      border-radius: 8px;
      padding: 10px;
      text-align: center;
      box-shadow: 0 0 10px #000;
    }
    #dobby-container img {
      width: 120px;
      border-radius: 10px;
    }
    #score-box {
      margin-top: 20px;
      background: #444;
      padding: 10px;
      border-radius: 8px;
      font-size: 16px;
    }
    canvas {
      background: #555;
      border-radius: 10px;
      box-shadow: 0 0 15px #000;
    }
    #restart-btn {
      display: none;
      margin-top: 20px;
      padding: 12px 24px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 18px;
      cursor: pointer;
    }
    #restart-btn:hover {
      background: #0056b3;
    }
    #x-link {
      display: none;
      margin-top: 8px;
      font-size: 13px;
    }
    #x-link a {
      color: #ccc;
      text-decoration: none;
    }
    #x-link a:hover {
      color: #fff;
    }
  </style>
</head>
<body>

<div id="container">
  <div id="dobby-container">
    <img src="dobby.png" alt="Dobby" />
    <div style="margin-top: 10px; font-weight: bold;">Dobby Car</div>
    <div id="score-box">
      <div>Score: <span id="score">0</span></div>
      <div>Level: <span id="level">1</span></div>
    </div>
  </div>
  <canvas id="game" width="400" height="600"></canvas>
</div>

<button id="restart-btn">Yeniden Başla</button>
<div id="x-link"><a href="https://x.com/Cavo994" target="_blank">@Cavo994</a></div>

<script>
  const canvas = document.getElementById("game");
  const ctx = canvas.getContext("2d");

  const roadWidth = 200;
  const roadX = (canvas.width - roadWidth) / 2;

  const carWidth = 50;
  const carHeight = 100;
  const obstacleWidth = 40;
  const obstacleHeight = carHeight / 2;

  const boneWidth = 30;
  const boneHeight = 30;
  const bonusWidth = 30;

  let carX = canvas.width / 2 - carWidth / 2;
  const carY = canvas.height - carHeight - 10;

  let leftPressed = false;
  let rightPressed = false;

  let obstacles = [];
  let bones = [];
  let bonuses = [];

  let score = 0;
  let level = 1;
  let speed = 3;
  let gameOver = false;

  let lastBonusTime = Date.now();

  const carImg = new Image();
  carImg.src = "bmw.png";

  const boneImg = new Image();
  boneImg.src = "bone.png";

  const bonusImg = new Image();
  bonusImg.src = "senti.png";

  const winImg = new Image();
  winImg.src = "win.png";

  const loseImg = new Image();
  loseImg.src = "lost.png";

  function drawRoad() {
    ctx.fillStyle = "#333";
    ctx.fillRect(roadX, 0, roadWidth, canvas.height);
  }

  function drawCar() {
    ctx.drawImage(carImg, carX, carY, carWidth, carHeight);
  }

  function drawObstacles() {
    ctx.fillStyle = "orange";
    obstacles.forEach(ob => {
      ctx.fillRect(ob.x, ob.y, obstacleWidth, obstacleHeight);
    });
  }

  function drawBones() {
    bones.forEach(bone => {
      ctx.drawImage(boneImg, bone.x, bone.y, boneWidth, boneHeight);
    });
  }

  function drawBonuses() {
    bonuses.forEach(b => {
      ctx.drawImage(bonusImg, b.x, b.y, bonusWidth, bonusWidth);
    });
  }

  function drawUI() {
    document.getElementById("score").textContent = score;
    document.getElementById("level").textContent = level;
  }

  function updateObjects() {
    obstacles.forEach(o => o.y += speed);
    bones.forEach(b => b.y += speed);
    bonuses.forEach(b => b.y += speed);

    obstacles = obstacles.filter(o => o.y < canvas.height);
    bones = bones.filter(b => b.y < canvas.height);
    bonuses = bonuses.filter(b => b.y < canvas.height);
  }

  function generateObstacles() {
    if (Math.random() < 0.01 + level * 0.0015) {
      const lanes = [0, 1, 2];
      const count = Math.min(2, Math.floor(Math.random() * 3));
      const selected = lanes.sort(() => 0.5 - Math.random()).slice(0, count);

      selected.forEach(i => {
        const x = roadX + i * (roadWidth / 3) + ((roadWidth / 3) - obstacleWidth) / 2;
        if (
          obstacles.length === 0 ||
          canvas.height - obstacles[obstacles.length - 1].y > 
          (level >= 10 ? carHeight : carHeight * 2)
        ) {
          obstacles.push({x, y: -obstacleHeight});
        }
      });
    }
  }

  function generateBones() {
    if (Math.random() < 0.01) {
      const lanes = [0, 1, 2];
      const lane = lanes[Math.floor(Math.random() * lanes.length)];
      const x = roadX + lane * (roadWidth / 3) + ((roadWidth / 3) - boneWidth) / 2;
      bones.push({x, y: -boneHeight});
    }
  }

  function generateBonus() {
    const now = Date.now();
    if (now - lastBonusTime > 5000) {
      const lane = Math.floor(Math.random() * 3);
      const x = roadX + lane * (roadWidth / 3) + ((roadWidth / 3) - bonusWidth) / 2;
      bonuses.push({x, y: -bonusWidth});
      lastBonusTime = now;
    }
  }

  function checkCollisions() {
    obstacles.forEach(ob => {
      if (rectIntersect(carX, carY, carWidth, carHeight, ob.x, ob.y, obstacleWidth, obstacleHeight)) {
        endGame(false);
      }
    });

    bones = bones.filter(b => {
      if (rectIntersect(carX, carY, carWidth, carHeight, b.x, b.y, boneWidth, boneHeight)) {
        score += 1;
        return false;
      }
      return true;
    });

    bonuses = bonuses.filter(b => {
      if (rectIntersect(carX, carY, carWidth, carHeight, b.x, b.y, bonusWidth, bonusWidth)) {
        score += 5;
        return false;
      }
      return true;
    });

    if (score >= level * 10 && level < 12) {
      level++;
      if (level >= 10) speed += 0.5;
    }

    if (level >= 12 && score >= 120) {
      endGame(true);
    }
  }

  function rectIntersect(x1, y1, w1, h1, x2, y2, w2, h2) {
    return !(x1 > x2 + w2 || x1 + w1 < x2 || y1 > y2 + h2 || y1 + h1 < y2);
  }

  function endGame(won) {
    gameOver = true;
    ctx.fillStyle = "black";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    const image = won ? winImg : loseImg;
    const text = won ? "Kazandınız!" : "Kaybettiniz";

    image.onload = () => {
      ctx.drawImage(image, canvas.width / 2 - 60, 100, 120, 120);
      ctx.fillStyle = "white";
      ctx.font = "30px Arial";
      ctx.textAlign = "center";
      ctx.fillText(text, canvas.width / 2, 250);
    };
    image.src = won ? "win.png" : "lost.png";

    document.getElementById("restart-btn").style.display = "block";
    document.getElementById("x-link").style.display = "block";
  }

  function gameLoop() {
    if (gameOver) return;

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    drawRoad();
    drawCar();
    drawObstacles();
    drawBones();
    drawBonuses();
    drawUI();

    updateObjects();
    generateObstacles();
    generateBones();
    generateBonus();
    checkCollisions();

    if (leftPressed && carX > roadX) carX -= 5;
    if (rightPressed && carX + carWidth < roadX + roadWidth) carX += 5;

    requestAnimationFrame(gameLoop);
  }

  document.addEventListener("keydown", (e) => {
    if (e.key === "ArrowLeft") leftPressed = true;
    if (e.key === "ArrowRight") rightPressed = true;
    if (e.key === "Enter" && gameOver) location.reload();
  });

  document.addEventListener("keyup", (e) => {
    if (e.key === "ArrowLeft") leftPressed = false;
    if (e.key === "ArrowRight") rightPressed = false;
  });

  document.getElementById("restart-btn").onclick = () => location.reload();

  window.onload = () => {
    requestAnimationFrame(gameLoop);
  };
</script>

</body>
</html>
